---
title: "バージョン1709時代のWSLリフレッシュ"
date: 2017-11-12T23:14:22+09:00
tags: ["TIL"]
---
Windows 10 Fall Creators Update（バージョン`1709`） において、Windows Subsystem for Linux（以下WSL）のアンインストールで少しハマりました。
<!--more-->

## WSLのアンインストールではまる
Windows Subsystem for Linux（以下WSL）で色々試してましたが、環境が汚くなってきたので一度初期化したいと思い、「Windowsの機能の有効化または無効化」から一度「Windows Subsystem for Linux」のチェックを外して再起動、またチェックを入れ直して再起動したところ、環境やデータは残ったままでした。まぁ、そりゃそうか。

そこでググったところ、`lxrun.exe`というコマンドがあるとのこと。

```
C:\>lxrun /?
警告: lxrun.exe は、Linux ディストリビューションのためにレガシ Windows サブシステムを構成するだけに使用されます。
ディストリビューションは次の Windows ストアを訪問してインストールすることができます:
https://aka.ms/wslstore

使用法:
     /install - サブシステムをインストールします
        オプションの引数:
            /y - ユーザーに許可を求めないか、ユーザー サブシステムを作成しない
     /uninstall - サブシステムをアンインストールします
        オプションの引数:
            /full - 完全アンインストールを実行します
            /y - ユーザーに確認を求めません
    /setdefaultuser - 既定のサブシステム ユーザーを設定します。ユーザー アカウントが存在しない場合は作成されます。
        オプションの引数:
            username - ユーザー名を指定します
            /y - ユーザー名が指定された場合、パスワードの作成を求めません
```

つまり `lxrun /uninstall /full /y` を実行すればいいわけです。

```
C:\>lxrun /uninstall /full /y
警告: lxrun.exe は、Linux ディストリビューションのためにレガシ Windows サブシステムを構成するだけに使用されます。
ディストリビューションは次の Windows ストアを訪問してインストールすることができます:
https://aka.ms/wslstore

これにより Windows 上の Ubuntu がアンインストールされます。
Ubuntu 環境およびすべての変更内容、新しいアプリケーション、およびユーザー データが削除されます。
アンインストールしています...
Windows Subsystem for Linux でインストール、アンインストール操作が保留中です。
```

保留中ってなんスか・・・。

なんか、更新プログラムのインストール等で再起動待ちになってるんじゃないかという感じらしいので、Windowsを再起動してもう一度試す。

```
Windows Subsystem for Linux でインストール、アンインストール操作が保留中です。
```

その後やったこと

- もう一度再起動してみる→`保留中です`
- 「Windowsの機能の有効化または無効化」でチェックを外した後`lxrun /uninstall`→そんなコマンドはありません。
- `lxrun /install`してみる→一生懸命ダウンロードした後にエラー

## TL;DR
**普通に「アプリと機能」上のUbuntuをアンインストールすればよかった** のでした。

2017年4月リリースのCreators Update（バージョン`1703`）では`lxrun.exe`での操作だったようですが、`1709`ではWSLが正式版となり、Ubuntu他LinuxのインストールがMicrosoft Storeからのインストールとなったため、この操作となるようです。再度WSLをインストールする際はダウンロードから行う必要があります。

わかってしまえばなんでそんなことでハマってたんだろうという結論でした。。。自分で考えずにGoogle先生に頼るのは良くないという教訓を学びました。（何回目だろうか・・・）

もっとスマートなやり方をご存知でしたら教えていただけると嬉しいです。